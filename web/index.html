<!DOCTYPE html>
<html lang="en">
<head>

    <meta charset="UTF-8">
    <title>管理员登录-WeAdmin Frame型后台管理系统-WeAdmin 1.0</title>
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="shortcut icon" href="./images/bg.png" type="image/x-icon" />
    <link rel="stylesheet" href="./css/font.css">
    <link rel="stylesheet" href="./css/weadmin.css">
    <link rel="icon" href="./images/20200212055840833_easyicon_net_32.ico" type="image/x-icon">
    <script src="./js/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="./js/jquery-3.4.0.js"></script>

</head>

<body class="login-bg">

    <div class="login">
        <div class="message">TimeMachine</div>
        <div id="darkbannerwrap"></div>
        <div id="show_login" class="show_login">
            <p>账号</p>
            <input id="account" name="account" type="text" lay-verify="required" class="layui-input">
            <hr class="hr15">
            <p>密码</p>
            <input id="password" name="password" lay-verify="required" type="password" class="layui-input">
            <hr class="hr15">
            <input id="login" onclick="login()" value="登录" lay-submit lay-filter="login" style="width:100%;"
                type="submit">
            <hr class="hr15">
            <input id="regist" onclick="regist()" value="注册" lay-submit lay-filter="login" style="width:100%;"
                type="submit">
            <hr class="hr20">
            <div><a onclick="show_managerLogin()" href="javascript:;">管理员登陆</a></div>
        </div>

        <div id="show_managerLogin" class="show_login" style="display: none;">
            <p>管理员账号</p>
            <input id="manager_account" name="manager_account" type="text" lay-verify="required" class="layui-input">
            <hr class="hr15">
            <p>管理员密码</p>
            <input id="manager_password" name="manager_password" lay-verify="required" type="password" class="layui-input">
            <hr class="hr15">
            <input id="manager_login" onclick="managerLogin()" value="登录" lay-submit lay-filter="login" style="width:100%;"
                type="submit">
            <hr class="hr20">
            <div><a onclick="back()" href="javascript:;">返回用户登陆</a></div>
        </div>
    </div>

    <script type="text/javascript">

        layui.extend({
            admin: './js/admin'
        });

        layui.use(['form', 'admin'], function () {
            var admin = layui.admin;
        });

        function login() {
            var account = $("#account").val();
            var password = $("#password").val();
            if (account == "" || password == "") {
                alert("请输入账号密码");
            } else {
                $.ajax({
                    type: "GET",
                    url: "http://182.61.18.240:8080/timemachine/user/",
                    data: {
                        "account": account,
                        "password": password
                    },
                    async: false,
                    cache: false,
                    success: function (data) {
                        if (JSON.parse(data).result == "success") {
                            //localstorage保存token
                            if(! window.localStorage){
                                alert("浏览器不支持localstorage");
                                return false;
                            }else{
                                var storage = window.sessionStorage;
                                storage.setItem("token", JSON.parse(data).data.token);
                                storage.setItem("userId", JSON.parse(data).data.userId);
                            }
                            window.location.href = "./pages/public_area.html";
                        } else {
                            alert(JSON.parse(data).description);
                        }
                    },
                    error: function () {
                        alert("系统错误");
                    }
                });
            }
        }

        function regist() {
            layer.open({
                type: 2,
                content: './pages/regist.html', //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
                title: ['用户注册', 'font-size:18px;'],
                area: ['500px', '750px']
            });
        }

        function show_managerLogin(){
            $("#show_login").css("display", "none");
            $("#show_managerLogin").css("display", "block");
        }

        function back(){
            $("#show_managerLogin").css("display", "none");
            $("#show_login").css("display", "block");
        }

        function managerLogin(){
            var account = $("#manager_account").val();
            var password = $("#manager_password").val();
            if (account == "" || password == "") {
                alert("请输入账号密码");
            } else {
                $.ajax({
                    type: "GET",
                    url: "http://182.61.18.240:8080/timemachine/manager/",
                    data: {
                        "account": account,
                        "password": password
                    },
                    async: false,
                    cache: false,
                    success: function (data) {
                        if (JSON.parse(data).result == "success") {
                            //localstorage保存token
                            if(! window.localStorage){
                                alert("浏览器不支持localstorage");
                                return false;
                            }else{
                                var storage = window.sessionStorage;
                                storage.setItem("token", JSON.parse(data).data.token);
                                storage.setItem("managerId", JSON.parse(data).data.managerId);
                            }
                            window.location.href = "./pages/manager/manager_main.html";
                        } else {
                            alert("账号密码错误");
                        }
                    },
                    error: function () {
                        alert("系统错误");
                    }
                });
            }
        }

    </script>
    <!-- 底部结束 -->
</body>

</html>