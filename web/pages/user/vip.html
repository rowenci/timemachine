<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>TimeMachine - Rowenci</title>
	<link rel="stylesheet" href="../../js/layui/css/layui.css">
</head>

<body class="layui-layout-body">
	<div class="layui-layout layui-layout-admin">
		<div class="layui-header">
			<div class="layui-logo">TimeMachine</div>
			<ul class="layui-nav layui-layout-right">
				<li class="layui-nav-item">
					<a href="javascript:;">
						<img id="head_image" src="" class="layui-nav-img">
						<span id="username"></span>
					</a>
					<dl class="layui-nav-child">
						<dd><a href="./userinfo.html">基本资料</a></dd>
						<dd><a href="">安全设置</a></dd>
					</dl>
				</li>
				<li class="layui-nav-item"><a href="" onclick="logout()">退出</a></li>
			</ul>
		</div>
		<div class="layui-side layui-bg-black">
			<div class="layui-side-scroll">
				<!-- 左侧导航区域（可配合layui已有的垂直导航） -->
				<ul class="layui-nav layui-nav-tree" lay-filter="test">
					<li class="layui-nav-item"><a href="../public_area.html">公共区域</a></li>
					<li class="layui-nav-item">
						<a class="" href="javascript:;">我的信件</a>
						<dl class="layui-nav-child">
							<dd><a href="../message/message.html">写信件</a></dd>
							<dd><a href="../message/list.html">信件列表</a></dd class="layui-this">
							<dd><a href="../message/public_list.html">公开信件</a></dd class="layui-this">
						</dl>
					</li>
					<li class="layui-nav-item">
						<a href="javascript:;">我的喜欢</a>
						<dl class="layui-nav-child">
							<dd><a href="../myfavorite/good_list.html">点赞列表</a></dd>
							<dd><a href="../myfavorite/favorite_list.html">收藏列表</a></dd>
						</dl>
					</li>
					<li class="layui-nav-item layui-nav-itemed layui-this"><a href="javascript:;">会员中心</a></li>
				</ul>
			</div>
		</div>

		<div class="layui-body">
			<!-- 内容主体区域 -->
			<fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
				<legend>会员中心</legend>
			</fieldset>

			<div class="layui-form-item">
				<label class="layui-form-label">用户名：</label>
				<div class="layui-input-inline">
					<p id="account" style="line-height: 40px; margin-left: 10px;"></p>
				</div>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">开通时间：</label>
				<p id="startTime" style="line-height: 40px; margin-left: 10px;"></p>
			</div>

			<div class="layui-form-item">
				<label class="layui-form-label">到期时间：</label>
				<p id="endTime" style="line-height: 40px; margin-left: 10px;"></p>
			</div>

			<div class="layui-form-item">
				<p id="vip_off" style="line-height: 40px; margin-left: 30px; color: red; display: none;">已经到期</p>
			</div>

			<button id="show_pay" type="button" class="layui-btn layui-btn-lg" style="margin-left: 30px; display: inline;"
				onclick="show_pay()">充值</button>
			<button id="refresh" type="button" class="layui-btn layui-btn-lg" style="margin-left: 30px; display: none;"
				onclick="refresh()">刷新信息</button>
		</div>

		<div class="layui-footer">
			<!-- 底部固定区域 -->
			© Rowenci.com
		</div>

		<script src="../../js/layui/layui.js"></script>
		<script type="text/javascript" src="../../js/jquery-3.4.0.js"></script>
		<script>

			//获取token  根据token向服务器请求数据
			var storage = window.sessionStorage;
			var token = storage.getItem("token");
			var userId = 1;
			//var userId = storage.getItem("userId") + "";

			//JavaScript代码区域
			layui.use('element', function () {
				var element = layui.element;
			});
			layui.use('layer', function () {
				var layer = layui.layer;
			});



			//获取信息
			$.ajax({
				type: "GET",
				url: "http://localhost:8080/timemachine/user/" + userId,
				data: {
					"token": token
				},
				async: false,
				cache: false,
				success: function (data) {
					if (JSON.parse(data).result == "success") {
						$("#head_image").attr("src", JSON.parse(data).data.image);
						$("#my_img").attr("src", JSON.parse(data).data.image);
						$("#account").text(JSON.parse(data).data.account);
						$("#username").text(JSON.parse(data).data.account);
						$("#payname").text(JSON.parse(data).data.account);
					} else {
						alert(JSON.parse(data).description);
					}
				},
				error: function () {
					alert("系统错误");
				}
			});

			//获取会员信息
			$.ajax({
				type: "GET",
				url: "http://localhost:8080/timemachine/vip-user/",
				data: {
					"token": token,
					"userId": userId
				},
				async: false,
				cache: false,
				success: function (data) {
					if (JSON.parse(data).result == "success") {
						console.log(JSON.parse(data));
						$("#startTime").html(JSON.parse(data).data.startTime);
						$("#endTime").html(JSON.parse(data).data.endTime);
						if (JSON.parse(data).data.status == 0) {
							$("#vip_off").css("display", "inline");
						}
					} else {
						alert(JSON.parse(data).description);
					}
				},
				error: function () {
					alert("系统错误");
				}
			});

			function show_pay() {
				$("#show_pay").css("display", "none");
				$("#refresh").css("display", "inline");
				window.open("pay.html", "_blank");
			}
			function refresh(){
				location.reload();
			}

			function logout() {
				$.ajax({
					type: "GET",
					url: "http://localhost:8080/timemachine/user/logOut/",
					data: {
						"token": token
					},
					async: false,
					cache: false,
					success: function (data) {
						if (JSON.parse(data).result == "success") {
							storage.clear();
							window.location.href = "../index.html";
						} else {
							alert(JSON.parse(data).description);
						}
					},
					error: function () {
						alert("系统错误");
					}
				});
			}
		</script>
</body>

</html>