<!DOCTYPE html>
<html id="show">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>TimeMachine - Rowenci</title>
    <link rel="stylesheet" href="../../js/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="../../css/amazeui.min.css" />
    <link rel="stylesheet" type="text/css" href="../../css/main.css" />
</head>

<body id="clear" class="layui-layout-body">
    <div class="pay">
        <!--主内容开始编辑-->
        <div class="tr_recharge">
            <div class="tr_rechtext">
                <p class="te_retit"><img src="../../images/coin.png" alt="" />充值中心</p>
            </div>
            <form action="" class="am-form" id="doc-vld-msg">
                <div class="tr_rechbox">
                    <div class="tr_rechhead">
                        <img src="../../images/ys_head2.jpg" />
                        <p>充值帐号：
                            <a id="payname"></a>
                        </p>
                    </div>
                    <div class="tr_rechli am-form-group">
                        <ul class="ui-choose am-form-group" id="uc_01">
                            <li>
                                <label class="am-radio-inline">
                                    <input type="radio" value="" name="docVlGender" required
                                        data-validation-message="请选择一项充值额度"> 一个月
                                </label>
                            </li>
                            <li>
                                <label class="am-radio-inline">
                                    <input type="radio" name="docVlGender" data-validation-message="请选择一项充值额度">
                                    两个月
                                </label>
                            </li>
                            <li>
                                <label class="am-radio-inline">
                                    <input type="radio" name="docVlGender" data-validation-message="请选择一项充值额度">
                                    三个月
                                </label>
                            </li>
                            <li>
                                <label class="am-radio-inline">
                                    <input type="radio" name="docVlGender" data-validation-message="请选择一项充值额度">
                                    半年
                                </label>
                            </li>
                        </ul>
                    </div>
                    </br>
                    <div class="tr_rechcho am-form-group">
                        <span>充值方式：</span>
                        <label class="am-radio" style="margin-right:30px;">
                            <input type="radio" name="radio1" value="" data-am-ucheck
                                data-validation-message="请选择一种充值方式" checked><img src="../../images/zfbpay.png">
                        </label>
                    </div>
                    <div class="tr_rechnum">
                        <span>应付金额：</span>
                        <p class="rechnum">0.00元</p>
                    </div>
                    <div class="tr_paybox">
                        <button onclick="pay()" type="button" class="layui-btn layui-btn-lg">支付</button>
                    </div>
                </div>
            </form>
        </div>

        <script src="../../js/layui/layui.js"></script>
        <script type="text/javascript" src="../../js/jquery-3.4.0.js"></script>
        <script type="text/javascript" src="../../js/amazeui.min.js"></script>
        <script type="text/javascript" src="../../js/ui-choose.js"></script>
        <script>

            //获取token  根据token向服务器请求数据
            var storage = window.sessionStorage;
            var token = storage.getItem("token");
            var userId = 1;
            //var userId = storage.getItem("userId") + "";

            //JavaScript代码区域
            layui.use('element', function () {
                var element = layui.element;
            });
            layui.use('layer', function () {
                var layer = layui.layer;
            });



            //获取信息
            $.ajax({
                type: "GET",
                url: "http://localhost:8080/timemachine/user/" + userId,
                data: {
                    "token": token
                },
                async: false,
                cache: false,
                success: function (data) {
                    if (JSON.parse(data).result == "success") {
                        $("#head_image").attr("src", JSON.parse(data).data.image);
                        $("#my_img").attr("src", JSON.parse(data).data.image);
                        $("#account").text(JSON.parse(data).data.account);
                        $("#username").text(JSON.parse(data).data.account);
                        $("#payname").text(JSON.parse(data).data.account);
                    } else {
                        alert(JSON.parse(data).description);
                    }
                },
                error: function () {
                    alert("系统错误");
                }
            });

            // 将所有.ui-choose实例化
            $('.ui-choose').ui_choose();
            // uc_01 ul 单选
            var uc_01 = $('#uc_01').data('ui-choose'); // 取回已实例化的对象
            uc_01.click = function (index, item) {
                console.log('click', index, item.text())
            }
            uc_01.change = function (index, item) {
                console.log('change', index, item.text())
            }
            $(function () {
                $('#uc_01 li:eq(0)').click(function () {
                    $('.tr_rechoth').hide();
                    $('.rechnum').text('10.00元');
                    $('.othbox').val('');
                })
                $('#uc_01 li:eq(1)').click(function () {
                    $('.tr_rechoth').hide();
                    $('.rechnum').text('20.00元');
                    $('.othbox').val('');
                })
                $('#uc_01 li:eq(2)').click(function () {
                    $('.tr_rechoth').hide();
                    $('.rechnum').text('30.00元');
                    $('.othbox').val('');
                })
                $('#uc_01 li:eq(3)').click(function () {
                    $('.tr_rechoth').hide();
                    $('.rechnum').text('60.00元');
                    $('.othbox').val('');
                })
                $(document).ready(function () {
                    $('.othbox').on('input propertychange', function () {
                        var num = $(this).val();
                        $('.rechnum').html(num + ".00元");
                    });
                });
            })

            function pay() {
                var num = $(".rechnum").text();
                if (num == "0.00元") {
                    alert("请选择充值月份");
                }
                var money;
                var vipMode;
                switch (num) {
                    case "10.00元":
                        money = 10;
                        vipMode = 1;
                        break;
                    case "20.00元":
                        money = 20;
                        vipMode = 2;
                        break;
                    case "30.00元":
                        money = 30;
                        vipMode = 3;
                        break;
                    case "60.00元":
                        money = 60;
                        vipMode = 4;
                        break;
                }
                $.ajax({
                    type: "GET",
                    url: "http://localhost:8080/timemachine/vip-user/aliPay/",
                    data: {
                        "token": token,
                        "userId": userId,
                        "money": money,
                        "vipMode": vipMode
                    },
                    async: false,
                    cache: false,
                    success: function (data) {
                        console.log(data);
                        $("#clear").html(data);
                    },
                    error: function () {
                        alert("系统错误");
                    }
                });
            }

        </script>
</body>

</html>